<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
  <title> Charm Check | Profile Review</title>
  <link rel="shortcut icon" href="favicon.png">
  <link rel="canonical" href="https://www.thecharmcheck.com">
  <meta name="robots" content="index, follow">
  <meta name="author" content="Anson Lai">
  <meta name="application-name" content="Charm Check">
  <meta name="description"
    content="Charm Check's profile reviews are instant and will give you actionable feedback to improve your photos and bio.  Access our chatbot to get even more tailored advice!">
  <meta name="keywords"
    content="dating, profile critique, relationship advice, profile optimization, online dating, dating app, Charm Check, evaluate, chamcheck, dating profile, tinder, bumble, hinge, coffee meets bagel, profile review, matches, ai, artificial intelligence, chatgpt">
  <meta name="twitter:title" content="Charm Check: Elevate Your Dating Profile">
  <meta name="twitter:description"
    content="Our AI-driven profile review gives you actionable feedback to improve your photos and bio!">
  <meta name="twitter:creator" content="@PharaohsVizier">
  <meta name="twitter:image" content="webpreview.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:title" content="Charm Check: Personalized Dating Profile Advice">
  <meta property="og:site_name" content="Charm Check">
  <meta property="og:description"
    content="Charm Check's profile reviews are instant and will give you actionable feedback to improve your photos and bio.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="webpreview.png">
  <meta property="og:logo" content="logo.png">
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Language" content="en-US">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta property="og:locale" content="en_US">
  <meta name="language" content="English">
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Charm Check",
      "url": "https://www.thecharmcheck.com",
      "description": "Charm Check's profile reviews are instant and will give you actionable feedback to improve your photos and bio.  Access our chatbot to get even more tailored advice!",
      "author": {
        "@type": "Person",
        "name": "Anson Lai",
        "email": "PharaohsVizier@gmail.com"
      },
      "image": "https://www.thecharmcheck.com/webpreview.png",
      "logo": "https://www.thecharmcheck.com/logo.png",
      "sameAs": [
        "https://twitter.com/PharaohsVizier"
      ],
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://www.thecharmcheck.com/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"
    integrity="sha512-LhccdVNGe2QMEfI3x4DVV3ckMRe36TfydKss6mJpdHjNFiV07dFpS2xzeZedptKZrwxfICJpez09iNioiSZ3hA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"
    integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.3.1/dist/html-docx.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.4/FileSaver.min.js"></script>
</head>

<style>
  pre {
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    white-space: -pre-wrap;
    white-space: -o-pre-wrap;
    word-wrap: break-word;
  }

  .assistant-convo p:last-child {
    margin-bottom: 0;
  }

  .user-convo p:last-child {
    margin-bottom: 0;
  }

  @media (max-width: 768px) {
    #chat-container {
      width: 85% !important;
    }
  }

  @media (max-width: 768px) {
    #chat-container-minimized {
      width: 65% !important;
    }
  }

  /* Styling for Stripe form */
  @media (max-width: 576px) {
    #payment-form {
      width: auto;
      min-width: 0;
      padding: 20px;
    }
  }

  @media (min-width: 768px) {
    #payment-form {
      width: 50vw;
      /* You can set this to your preferred width */
      padding: 30px;
      /* Adjust padding if needed */
    }
  }

  @media (min-width: 992px) {
    #payment-form {
      width: 40vw;
      /* You can set this to your preferred width */
      padding: 40px;
      /* Adjust padding if needed */
    }
  }

  @media (min-width: 1200px) {
    #payment-form {
      width: 30vw;
      /* This is your original width, adjust if needed */
      padding: 40px;
      /* This is your original padding, adjust if needed */
    }
  }
</style>

<body class="d-flex flex-column h-100" onload="setup()">
  <nav class="navbar navbar-expand-md navbar-light">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <div style="height: 3rem; width: 3rem;">
          <?xml version="1.0" encoding="UTF-8" standalone="no"?>
          <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
          <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0.00 0.00 296.00 303.00">
            <g stroke-width="2.00" fill="none" stroke-linecap="butt">
              <path stroke="#b12b3c" vector-effect="non-scaling-stroke" d="
            M 18.72 130.16
            Q 11.84 175.67 32.59 216.10
            C 46.11 242.47 68.18 262.36 94.44 274.76
            C 145.70 298.95 209.12 285.45 246.87 243.31
            C 252.02 237.57 260.05 228.30 263.96 221.72
            C 271.08 209.72 264.22 191.91 249.50 190.55
            C 238.43 189.53 233.93 194.97 228.32 203.27
            Q 224.13 209.47 216.46 217.70
            C 195.95 239.71 168.58 250.72 138.44 247.08
            C 118.78 244.71 101.34 236.72 86.86 223.33
            C 68.92 206.73 59.21 186.76 56.55 162.47" />
              <path stroke="#b12b3c" vector-effect="non-scaling-stroke" d="
            M 56.55 162.47
            C 54.77 141.24 58.95 118.36 70.92 100.43
            C 95.63 63.41 139.06 45.38 181.48 63.94
            Q 190.57 67.92 192.37 68.25
            Q 200.23 69.68 207.49 64.72
            C 217.91 57.60 216.93 42.81 208.83 34.63
            Q 204.73 30.50 194.53 26.68
            C 175.36 19.51 153.38 15.20 133.44 17.90
            Q 80.59 25.08 47.46 65.92
            C 32.83 83.96 22.24 107.24 18.72 130.16" />
              <path stroke="#b12b3c" vector-effect="non-scaling-stroke" d="
            M 56.55 162.47
            Q 56.08 162.51 55.82 163.24
            Q 55.73 163.49 55.62 163.25
            Q 55.56 163.13 55.50 163.00
            A 0.14 0.14 0.0 0 0 55.25 163.00
            Q 55.19 163.13 55.12 163.26
            Q 55.11 163.28 55.11 163.26
            Q 55.03 162.98 54.72 162.80
            Q 54.56 162.70 54.45 162.79
            Q 54.38 162.85 54.37 162.75
            Q 54.19 161.42 52.96 160.93
            Q 52.40 160.71 52.40 161.31
            Q 52.40 162.03 53.23 162.49
            Q 53.25 162.50 53.22 162.46
            Q 53.18 162.38 53.29 162.37
            Q 53.38 162.36 53.38 162.50
            Q 53.38 162.64 53.38 162.77
            A 0.10 0.03 9.6 0 1 53.27 162.78
            L 49.51 162.09
            Q 49.44 162.07 49.46 162.05
            Q 49.53 161.95 49.60 161.83
            Q 49.68 161.66 49.55 161.53
            Q 48.14 160.06 47.35 158.19
            Q 47.17 157.76 46.75 157.54
            Q 46.03 157.17 45.91 156.45
            Q 45.86 156.16 45.76 155.87
            Q 45.52 155.12 45.06 154.44
            Q 44.80 154.06 44.76 153.59
            Q 44.67 152.53 43.71 152.26
            Q 43.28 152.14 43.04 151.77
            Q 41.84 149.90 40.09 148.59
            C 38.97 147.74 38.26 146.52 36.86 145.91
            Q 36.40 145.71 36.08 145.34
            Q 35.04 144.13 33.39 143.20
            Q 32.91 142.93 32.75 142.24
            A 1.03 1.02 -77.9 0 0 32.36 141.63
            Q 29.24 139.30 25.92 137.30
            C 25.03 136.77 24.11 136.80 23.16 136.11
            Q 22.79 135.84 22.57 135.44
            Q 21.94 134.29 20.85 133.72
            Q 20.53 133.55 20.40 133.21
            L 19.70 131.42
            Q 19.48 130.86 19.89 130.41
            Q 20.45 129.80 20.29 128.90
            Q 20.25 128.65 20.00 128.70
            L 19.75 128.74
            Q 19.67 128.76 19.68 128.84
            Q 19.84 130.20 18.72 130.16" />
              <path stroke="#b12b3c" vector-effect="non-scaling-stroke" d="
            M 154.91 163.29
            A 0.64 0.64 0.0 0 1 153.98 163.30
            Q 140.34 149.29 126.60 135.24
            Q 118.91 127.38 116.63 126.11
            C 107.37 120.95 95.59 125.30 90.65 134.61
            C 84.05 147.05 90.32 155.98 98.92 164.83
            Q 116.96 183.41 135.30 201.70
            Q 140.99 207.37 144.35 209.02
            C 153.72 213.62 164.65 209.74 171.76 202.73
            C 203.96 170.96 235.79 138.75 268.33 107.33
            Q 273.82 102.03 275.30 98.53
            C 279.26 89.11 275.07 78.55 267.70 73.30
            C 258.82 66.98 248.90 68.53 241.25 75.98
            Q 221.73 95.01 211.61 105.36
            C 192.72 124.67 173.51 143.70 154.91 163.29" />
            </g>
            <path fill="#b12b3c" d="
            M 56.55 162.47
            Q 56.08 162.51 55.82 163.24
            Q 55.73 163.49 55.62 163.25
            Q 55.56 163.13 55.50 163.00
            A 0.14 0.14 0.0 0 0 55.25 163.00
            Q 55.19 163.13 55.12 163.26
            Q 55.11 163.28 55.11 163.26
            Q 55.03 162.98 54.72 162.80
            Q 54.56 162.70 54.45 162.79
            Q 54.38 162.85 54.37 162.75
            Q 54.19 161.42 52.96 160.93
            Q 52.40 160.71 52.40 161.31
            Q 52.40 162.03 53.23 162.49
            Q 53.25 162.50 53.22 162.46
            Q 53.18 162.38 53.29 162.37
            Q 53.38 162.36 53.38 162.50
            Q 53.38 162.64 53.38 162.77
            A 0.10 0.03 9.6 0 1 53.27 162.78
            L 49.51 162.09
            Q 49.44 162.07 49.46 162.05
            Q 49.53 161.95 49.60 161.83
            Q 49.68 161.66 49.55 161.53
            Q 48.14 160.06 47.35 158.19
            Q 47.17 157.76 46.75 157.54
            Q 46.03 157.17 45.91 156.45
            Q 45.86 156.16 45.76 155.87
            Q 45.52 155.12 45.06 154.44
            Q 44.80 154.06 44.76 153.59
            Q 44.67 152.53 43.71 152.26
            Q 43.28 152.14 43.04 151.77
            Q 41.84 149.90 40.09 148.59
            C 38.97 147.74 38.26 146.52 36.86 145.91
            Q 36.40 145.71 36.08 145.34
            Q 35.04 144.13 33.39 143.20
            Q 32.91 142.93 32.75 142.24
            A 1.03 1.02 -77.9 0 0 32.36 141.63
            Q 29.24 139.30 25.92 137.30
            C 25.03 136.77 24.11 136.80 23.16 136.11
            Q 22.79 135.84 22.57 135.44
            Q 21.94 134.29 20.85 133.72
            Q 20.53 133.55 20.40 133.21
            L 19.70 131.42
            Q 19.48 130.86 19.89 130.41
            Q 20.45 129.80 20.29 128.90
            Q 20.25 128.65 20.00 128.70
            L 19.75 128.74
            Q 19.67 128.76 19.68 128.84
            Q 19.84 130.20 18.72 130.16
            C 22.24 107.24 32.83 83.96 47.46 65.92
            Q 80.59 25.08 133.44 17.90
            C 153.38 15.20 175.36 19.51 194.53 26.68
            Q 204.73 30.50 208.83 34.63
            C 216.93 42.81 217.91 57.60 207.49 64.72
            Q 200.23 69.68 192.37 68.25
            Q 190.57 67.92 181.48 63.94
            C 139.06 45.38 95.63 63.41 70.92 100.43
            C 58.95 118.36 54.77 141.24 56.55 162.47
            Z" />
            <path fill="#b12b3c" d="
            M 154.91 163.29
            C 173.51 143.70 192.72 124.67 211.61 105.36
            Q 221.73 95.01 241.25 75.98
            C 248.90 68.53 258.82 66.98 267.70 73.30
            C 275.07 78.55 279.26 89.11 275.30 98.53
            Q 273.82 102.03 268.33 107.33
            C 235.79 138.75 203.96 170.96 171.76 202.73
            C 164.65 209.74 153.72 213.62 144.35 209.02
            Q 140.99 207.37 135.30 201.70
            Q 116.96 183.41 98.92 164.83
            C 90.32 155.98 84.05 147.05 90.65 134.61
            C 95.59 125.30 107.37 120.95 116.63 126.11
            Q 118.91 127.38 126.60 135.24
            Q 140.34 149.29 153.98 163.30
            A 0.64 0.64 0.0 0 0 154.91 163.29
            Z" />
            <path fill="#b12b3c" d="
            M 56.55 162.47
            C 59.21 186.76 68.92 206.73 86.86 223.33
            C 101.34 236.72 118.78 244.71 138.44 247.08
            C 168.58 250.72 195.95 239.71 216.46 217.70
            Q 224.13 209.47 228.32 203.27
            C 233.93 194.97 238.43 189.53 249.50 190.55
            C 264.22 191.91 271.08 209.72 263.96 221.72
            C 260.05 228.30 252.02 237.57 246.87 243.31
            C 209.12 285.45 145.70 298.95 94.44 274.76
            C 68.18 262.36 46.11 242.47 32.59 216.10
            Q 11.84 175.67 18.72 130.16
            Q 19.84 130.20 19.68 128.84
            Q 19.67 128.76 19.75 128.74
            L 20.00 128.70
            Q 20.25 128.65 20.29 128.90
            Q 20.45 129.80 19.89 130.41
            Q 19.48 130.86 19.70 131.42
            L 20.40 133.21
            Q 20.53 133.55 20.85 133.72
            Q 21.94 134.29 22.57 135.44
            Q 22.79 135.84 23.16 136.11
            C 24.11 136.80 25.03 136.77 25.92 137.30
            Q 29.24 139.30 32.36 141.63
            A 1.03 1.02 -77.9 0 1 32.75 142.24
            Q 32.91 142.93 33.39 143.20
            Q 35.04 144.13 36.08 145.34
            Q 36.40 145.71 36.86 145.91
            C 38.26 146.52 38.97 147.74 40.09 148.59
            Q 41.84 149.90 43.04 151.77
            Q 43.28 152.14 43.71 152.26
            Q 44.67 152.53 44.76 153.59
            Q 44.80 154.06 45.06 154.44
            Q 45.52 155.12 45.76 155.87
            Q 45.86 156.16 45.91 156.45
            Q 46.03 157.17 46.75 157.54
            Q 47.17 157.76 47.35 158.19
            Q 48.14 160.06 49.55 161.53
            Q 49.68 161.66 49.60 161.83
            Q 49.53 161.95 49.46 162.05
            Q 49.44 162.07 49.51 162.09
            L 53.27 162.78
            A 0.10 0.03 9.6 0 0 53.38 162.77
            Q 53.38 162.64 53.38 162.50
            Q 53.38 162.36 53.29 162.37
            Q 53.18 162.38 53.22 162.46
            Q 53.25 162.50 53.23 162.49
            Q 52.40 162.03 52.40 161.31
            Q 52.40 160.71 52.96 160.93
            Q 54.19 161.42 54.37 162.75
            Q 54.38 162.85 54.45 162.79
            Q 54.56 162.70 54.72 162.80
            Q 55.03 162.98 55.11 163.26
            Q 55.11 163.28 55.12 163.26
            Q 55.19 163.13 55.25 163.00
            A 0.14 0.14 0.0 0 1 55.50 163.00
            Q 55.56 163.13 55.62 163.25
            Q 55.73 163.49 55.82 163.24
            Q 56.08 162.51 56.55 162.47
            Z" />
          </svg>
        </div>
        <span style="margin-left: 0.6rem; font-size: 2rem; color: #b12b3c;"><strong
            style="color: rgb(39, 39, 39)">Charm</strong>Check</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"
        style="border-color: rgba(255, 255, 255, 0);">
        <span class="navbar-toggler-icon" style="color:#5469d4"></span>
      </button>

      <div class="collapse navbar-collapse ms-4" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link me-3 position-relative text-dark" style="font-size: 1.25rem;"
              href="profile-review.html">Profile Review</a>
          </li>
          <li class="nav-item">
            <a class="nav-link me-3 position-relative text-dark" style="font-size: 1.25rem;" href="batch.html">Batch
              Photos<span class="position-absolute start-100 translate-middle badge rounded-pill bg-danger"
                style="font-size: 0.55rem; top: 25%;">NEW</span></a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="flex-grow-1">
    <div class="container">

      <div class="row g-0">
        <div id="padding-container" class="d-none d-md-block" style="padding-top: 5rem; padding-bottom: 5rem;"></div>
        <div style="padding-top: 1rem; padding-bottom: 1rem;"></div>

        <div id="photoCollector" class="col-md-6 offset-md-3 bg-white rounded shadow">
          <div class="row bg-white w-100 g-0 pt-5 pb-1 rounded-top text-dark text-center"
            style="background: linear-gradient(rgba(21, 2, 2, 0.85), rgba(66, 6, 6, 0.75)), url('openaivtestbg.png'); background-size: cover; background-position: center; ">
            <div class="col d-flex flex-column align-items-center">
              <div class="mb-3 pt-3 text-center text-white" style="border-radius: .5rem; width: 50%; min-width: 200px;">
                <h2><strong>Profile Review</strong></h2>
                <h6>Share your online dating profile details and get <strong>FREE</strong> personalized feedback!</h6>
                <br><br><br>
                <h6 class="text-white mb-0"><small>Powered by OpenAI</small></h6>
              </div>
            </div>
          </div>

          <div class="row bg-white w-100 g-0 py-5 rounded-bottom text-dark">
            <div class="d-flex flex-column align-items-center">
              <div class="col d-flex flex-column align-items-center">
                <!-- Drop area -->
                <div id="drop-area" class="drop-area mb-3 p-3 text-center text-dark"
                  style="border: 2px dashed #df3b3b; border-radius: .5rem; width: 50%; min-width: 200px;">
                  <p class="mb-0"><strong>Drop Photos Here</strong></p>
                </div>
              </div>
              <div class="d-flex align-items-center w-25 my-3">
                <hr class="flex-grow-1">
                <span class="mx-2">or</span>
                <hr class="flex-grow-1">
              </div>
              <!-- File input -->
              <div class="text-center mt-3 mb-3">
                <input type="file" id="fileElem" accept="image/*" multiple style="display: none;">
                <label class="btn btn-danger p-3 px-5" for="fileElem"><strong>Select Photos</strong></label>
              </div>
              <div class="d-flex align-items-center w-25 my-3">
                <hr class="flex-grow-1">
                <span class="mx-2">or</span>
                <hr class="flex-grow-1">
              </div>
              <!-- Tinder input -->
              <div class="text-center mt-3 mb-3">
                <h5 class="card-title text-center">Use your <span style="color: #EE2C6B"><strong>Tinder</strong></span>
                  photos!
                </h5>
                <div class="input-group mb-2">
                  <input id="tinderURL" type="url" class="form-control" aria-describedby="detailsHelp"
                    placeholder="https://tinder.com/@username" maxlength="180">
                  <button id="fetchProfileButton" class="btn btn-outline-secondary">></button>
                </div>
                <div id="tinder-loader" class="container text-center mb-2 py-1 d-none" style="">
                  <div class="spinner-grow" role="status" style="height: 0.5rem; width: 0.5rem;">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <div class="spinner-grow" role="status" style="height: 0.5rem; width: 0.5rem; -webkit-animation: .75s linear 0.25s infinite spinner-grow;
                  animation: .75s linear 0.25s infinite spinner-grow;">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <div class="spinner-grow" role="status" style="height: 0.5rem; width: 0.5rem; -webkit-animation: .75s linear 0.5s infinite spinner-grow;
                  animation: .75s linear 0.5s infinite spinner-grow;">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
            <!-- Container for the processed images -->
            <div id="image-container" class="d-flex justify-content-center align-items-center flex-wrap">
            </div>
          </div>
        </div>

        <div id="formCollection" class="col-md-6 px-5 py-2 d-none mt-5 mt-md-0 text-dark">
          <div class="mb-5">
            <label for="appDescription" class="form-label h6">Dating App</label>
            <select class="form-select" id="appDescription" aria-label="Default select example">
              <option value='Tinder' selected>Tinder</option>
              <option value='Hinge'>Hinge</option>
              <option value='Bumble'>Bumble</option>
              <option value='Other App'>Other</option>
            </select>
          </div>
          <hr>
          <form>
            <div class=" mt-4 mb-3">
              <label for="aboutMeDescription" class="form-label h6">About Me</label>
              <textarea class="form-control" id="aboutMeDescription" rows="5" aria-describedby="aboutMeHelp"
                maxlength="600"></textarea>
              <small id="aboutMeHelp" class="form-text text-muted">Provide your current profile bio. Note that many
                platforms limit character length.</small>
            </div>
            <div class="mb-3">
              <label for="ageDescription" class="form-label h6">Age</label>
              <input type="text" class="form-control" id="ageDescription" aria-describedby="ageHelp" maxlength="30">
              <small id="ageHelp" class="form-text text-muted">Enter your age. You may specify a range.</small>
            </div>
            <div class="mb-3">
              <label for="interestsDescription" class="form-label h6">Interests</label>
              <input type="text" class="form-control" id="interestsDescription" aria-describedby="interestsHelp"
                maxlength="150">
              <small id="interestsHelp" class="form-text text-muted">Enter your interests and hobbies.</small>
            </div>
            <div class="mb-3">
              <label for="relationshipTypeDescription" class="form-label h6">Relationship Type</label>
              <input type="text" class="form-control" id="relationshipTypeDescription"
                aria-describedby="relationshipHelp" maxlength="80">
              <small id="relationshipHelp" class="form-text text-muted">Specify the type of relationship you are looking
                for.</small>
            </div>
            <div class="mb-3">
              <label for="jobTitleDescription" class="form-label h6">Job Title or School</label>
              <input type="text" class="form-control" id="jobTitleDescription" aria-describedby="jobTitleHelp"
                maxlength="80">
              <small id="jobTitleHelp" class="form-text text-muted">Enter your job title or the school you
                attend.</small>
            </div>
            <div class="mb-3">
              <label for="importantDetailsDescription" class="form-label h6">Misc Important Details</label>
              <input type="text" class="form-control" id="importantDetailsDescription" aria-describedby="detailsHelp"
                maxlength="180">
              <small id="detailsHelp" class="form-text text-muted">Include any details you feel are important (i.e.
                height, ethnicity, language, sexual orientation).</small>
            </div>
            <div class="mb-3">
              <label for="promptsDescription1" class="form-label h6">First Prompt</label>
              <input type="text" class="form-control mb-1" id="promptsDescription1" aria-describedby="promptsHelp1"
                maxlength="150"></textarea>
              <textarea class="form-control" id="promptsAnswerDescription1" rows="3"
                aria-describedby="promptsAnswerHelp1" maxlength="350"></textarea>
              <small id="promptsAnswerHelp1" class="form-text text-muted">Write your prompt and your answer to the
                prompt here.</small>
            </div>
            <div class="mb-3">
              <label for="promptsDescription2" class="form-label h6">Second Prompt</label>
              <input type="text" class="form-control mb-1" id="promptsDescription2" aria-describedby="promptsHelp2"
                maxlength="150"></input>
              <textarea class="form-control" id="promptsAnswerDescription2" rows="3"
                aria-describedby="promptsAnswerHelp2" maxlength="350"></textarea>
              <small id="promptsAnswerHelp2" class="form-text text-muted">Write your second prompt and your answer to
                the prompt here.</small>
            </div>
            <div class="mb-3">
              <label for="promptsDescription3" class="form-label h6">Third Prompt</label>
              <input type="text" class="form-control mb-1" id="promptsDescription3" aria-describedby="promptsHelp3"
                maxlength="150"></input>
              <textarea class="form-control" id="promptsAnswerDescription3" rows="3"
                aria-describedby="promptsAnswerHelp3" maxlength="350"></textarea>
              <small id="promptsAnswerHelp3" class="form-text text-muted">Write your third prompt and your answer to the
                prompt here.</small>
            </div>
            <div class="mb-3">
              <label for="additionalInformationDescription" class="form-label h6">Additional Information</label>
              <textarea class="form-control" id="additionalInformationDescription" rows="5"
                aria-describedby="additionalInformationHelp" maxlength="850"></textarea>
              <small id="additionalInformationHelp" class="form-text text-muted">Write any additional prompts and
                answers here.</small>
            </div>
          </form>
          <div class="d-flex justify-content-center">
            <button id="sendButton" class="btn btn-danger mt-5 p-3 px-5" onclick="sendToAPI()"
              aria-describedby="sendHelp">
              <strong>Fix my profile!</strong>
            </button>
          </div>

          <p id="countdownWarning" class="form-text text-center text-danger d-none"><strong>We are limiting users to 3
              free profile reviews
              every 72 hours. Your free reviews will refresh in <span id="countdownDisplay">72 hours</span>. <a
                class="link-primary hover-primary" data-bs-toggle="modal" data-bs-target="#paymentModal"
                onClick="initialize(); checkStatus();">Click
                here</a> to skip the line!</strong></p>

          <div id="sendHelp" class="form-text text-center text-muted">Charm Check and our AI partners will delete your photos shortly after our analysis.</div>

          <div id="loader" class="container text-center my-4 invisible">
            <div class="spinner-grow" role="status" style="height: 0.5rem; width: 0.5rem;">
              <span class="visually-hidden">Loading...</span>
            </div>
            <div class="spinner-grow" role="status" style="height: 0.5rem; width: 0.5rem; -webkit-animation: .75s linear 0.25s infinite spinner-grow;
                animation: .75s linear 0.25s infinite spinner-grow;">
              <span class="visually-hidden">Loading...</span>
            </div>
            <div class="spinner-grow" role="status" style="height: 0.5rem; width: 0.5rem; -webkit-animation: .75s linear 0.5s infinite spinner-grow;
                animation: .75s linear 0.5s infinite spinner-grow;">
              <span class="visually-hidden">Loading...</span>
            </div>
            <div class="form-text">Analysis may take up to 60 seconds.</div>
          </div>
        </div>

      </div>

      <div class="row g-0 position-relative">
        <div id="analysis-container" class="col my-5 d-none">
          <button onclick="downloadAsDocx()" class="btn btn-danger position-absolute top-1 end-0 m-3">Download
            Report</button>
          <div id="report-container" class="bg-white text-dark rounded shadow">
            <p class="h1 text-center pt-5" style="color:#A7A5A5">Charm Check Report</p>
            <p id="apiResponse" class="p-5"></p>
          </div>
        </div>
      </div>

      <div class="card border-0 d-none" id="chat-container"
        style="position: fixed; bottom: 0px; right: 0px; z-index: 1000; width: 40%; max-height: 80%; display: flex; flex-direction: column;">
        <div class="card-header bg-danger text-white d-flex align-items-center justify-content-between">
          <strong>Charm Check Chatbot</strong>
          <button class="close-btn text-white pe-3" id="close-chat-container-button"
            style="border: none; background: transparent; cursor: pointer; font-size: 1.5rem; padding: 0 5px;"><strong>&#8211;</strong></button>
        </div>
        <div class="card-body flex-grow-1 d-flex flex-column overflow-hidden pb-0">
          <div id="chatDisplay" class="flex-grow-1 overflow-auto pt-1 pb-1 px-3">
            <div class="row py-2">
              <div class="col-11 ps-0">
                <div class="h-100 d-flex align-items-center p-3 rounded shadow-sm ms-3"
                  style="background-color: #f9f9f9;">
                  ðŸ‘‹ Hi! I'm the Charm Check chatbot. Let's chat about your results or workshop your bio! Where do you
                  want to start first?
                </div>
              </div>
              <div class="col-1 d-flex align-items-center justify-content-center" style="font-size: 3rem;">
                <div class="d-flex align-items-center me-3">
                </div>
              </div>
            </div>
          </div>
          <div id="chat-loader" class="container text-center mb-1" style="visibility:hidden;">
            <div class="spinner-grow" role="status" style="height: 0.5rem; width: 0.5rem;">
              <span class="visually-hidden">Loading...</span>
            </div>
            <div class="spinner-grow" role="status" style="height: 0.5rem; width: 0.5rem; -webkit-animation: .75s linear 0.25s infinite spinner-grow;
            animation: .75s linear 0.25s infinite spinner-grow;">
              <span class="visually-hidden">Loading...</span>
            </div>
            <div class="spinner-grow" role="status" style="height: 0.5rem; width: 0.5rem; -webkit-animation: .75s linear 0.5s infinite spinner-grow;
            animation: .75s linear 0.5s infinite spinner-grow;">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
        <div class="container px-1 m-1">
          <div class="input-group">
            <textarea class="form-control autoExpand" placeholder="Send a message" id="floatingTextarea" rows='1'
              data-min-rows='1' style="max-height: 10rem;"></textarea>
            <button class="btn btn-outline-secondary" type="button" id="buttonSend">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path fill="currentColor" d="M2.01 21L23 12L2.01 3L2 10l15 2l-15 2z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Paywall Overlay -->
    <!-- <div id="paywallOverlay"
            class="overlay position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center d-none"
            style="background-color: rgba(0, 0, 0, 0.5); transition: background-color 1s ease;">
            <button class="btn btn-danger w-100 mx-3" data-bs-toggle="modal" data-bs-target="#paymentModal"
              onClick="initialize(); checkStatus();">
              <strong class="lead" style="font-size: 1.5rem;">Still need help?</strong><br>Unlock unlimited
              profile reviews for 7 days - only <span style="font-weight: 900;">$3.99!</span>
          </div> -->
    </div>
    </div>
    </div>

    <div class="card border-0 d-none" id="chat-container-minimized"
      style="position: fixed; bottom: 0px; right: 0px; z-index: 1000; width: 25%; cursor: pointer;">
      <button class="close-btn text-white pe-3" id="close-chat-container-button"
        style="position: absolute; top: 0; right: 0; border: none; background: transparent; font-size: 1.5rem; padding: 0 5px;"><strong>&#43;</strong></button>
      <div class="card-header bg-danger text-white">
        <strong>Charm Check Chatbot</strong>
      </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header border-bottom-0 bg-dark text-white">
            <div class="col text-center">
              <h1 class="modal-title fs-5" id="paymentModalLabel">Unlimited Profile Reviews (7 Days)</h1>
              <h1 class="fs-3">$3.99 USD</h1>
            </div>
            <div class="col-auto">
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
          </div>
          <div class="modal-body d-flex justify-content-center align-items-center">
            <div id="payment-form" class="shadow rounded-3 p-3" style="max-width: 100%; overflow-x: auto;">
              <div id="payment-element" style="margin-bottom: 24px;">
                <!--Stripe.js injects the Payment Element here-->
              </div>
              <label for="paymentSubmit" class="mb-2"></label>
              <button id="paymentSubmit" onclick="handleSubmit()"
                style="background: #5469d4; color: #ffffff; border-radius: 4px; border: 0; padding: 12px 16px; font-size: 16px; font-weight: 600; cursor: pointer; display: block; box-shadow: 0px 4px 5.5px 0px rgba(0, 0, 0, 0.07); width: 100%;">
                <div class="spinner hidden" id="spinner"></div>
                <span id="button-text">Pay $3.99</span>
              </button>
              <div id="payment-message" class="hidden"
                style="color: rgb(105, 115, 134); font-size: 16px; line-height: 20px; padding-top: 12px; text-align: center;">
              </div>
              <div class="d-flex justify-content-end">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="5.1rem"
                  height="2.1rem" viewBox="0 0 512 214" version="1.1" preserveAspectRatio="xMidYMid">
                  <g>
                    <path
                      d="M35.9822222,83.4844444 C35.9822222,77.9377778 40.5333333,75.8044444 48.0711111,75.8044444 C58.88,75.8044444 72.5333333,79.0755556 83.3422222,84.9066667 L83.3422222,51.4844444 C71.5377778,46.7911111 59.8755556,44.9422222 48.0711111,44.9422222 C19.2,44.9422222 0,60.0177778 0,85.1911111 C0,124.444444 54.0444444,118.186667 54.0444444,135.111111 C54.0444444,141.653333 48.3555556,143.786667 40.3911111,143.786667 C28.5866667,143.786667 13.5111111,138.951111 1.56444444,132.408889 L1.56444444,166.257778 C14.7911111,171.946667 28.16,174.364444 40.3911111,174.364444 C69.9733333,174.364444 90.3111111,159.715556 90.3111111,134.257778 C90.1688889,91.8755556 35.9822222,99.4133333 35.9822222,83.4844444 Z M132.124444,16.4977778 L97.4222222,23.8933333 L97.28,137.813333 C97.28,158.862222 113.066667,174.364444 134.115556,174.364444 C145.777778,174.364444 154.311111,172.231111 159.004444,169.671111 L159.004444,140.8 C154.453333,142.648889 131.982222,149.191111 131.982222,128.142222 L131.982222,77.6533333 L159.004444,77.6533333 L159.004444,47.36 L131.982222,47.36 L132.124444,16.4977778 Z M203.235556,57.8844444 L200.96,47.36 L170.24,47.36 L170.24,171.804444 L205.795556,171.804444 L205.795556,87.4666667 C214.186667,76.5155556 228.408889,78.5066667 232.817778,80.0711111 L232.817778,47.36 C228.266667,45.6533333 211.626667,42.5244444 203.235556,57.8844444 Z M241.493333,47.36 L277.191111,47.36 L277.191111,171.804444 L241.493333,171.804444 L241.493333,47.36 Z M241.493333,36.5511111 L277.191111,28.8711111 L277.191111,0 L241.493333,7.53777778 L241.493333,36.5511111 Z M351.431111,44.9422222 C337.493333,44.9422222 328.533333,51.4844444 323.555556,56.0355556 L321.706667,47.2177778 L290.417778,47.2177778 L290.417778,213.048889 L325.973333,205.511111 L326.115556,165.262222 C331.235556,168.96 338.773333,174.222222 351.288889,174.222222 C376.746667,174.222222 399.928889,153.742222 399.928889,108.657778 C399.786667,67.4133333 376.32,44.9422222 351.431111,44.9422222 Z M342.897778,142.933333 C334.506667,142.933333 329.528889,139.946667 326.115556,136.248889 L325.973333,83.4844444 C329.671111,79.36 334.791111,76.5155556 342.897778,76.5155556 C355.84,76.5155556 364.8,91.0222222 364.8,109.653333 C364.8,128.711111 355.982222,142.933333 342.897778,142.933333 Z M512,110.08 C512,73.6711111 494.364444,44.9422222 460.657778,44.9422222 C426.808889,44.9422222 406.328889,73.6711111 406.328889,109.795556 C406.328889,152.604444 430.506667,174.222222 465.208889,174.222222 C482.133333,174.222222 494.933333,170.382222 504.604444,164.977778 L504.604444,136.533333 C494.933333,141.368889 483.84,144.355556 469.76,144.355556 C455.964444,144.355556 443.733333,139.52 442.168889,122.737778 L511.715556,122.737778 C511.715556,120.888889 512,113.493333 512,110.08 Z M441.742222,96.5688889 C441.742222,80.4977778 451.555556,73.8133333 460.515556,73.8133333 C469.191111,73.8133333 478.435556,80.4977778 478.435556,96.5688889 L441.742222,96.5688889 L441.742222,96.5688889 Z"
                      fill="#e6e6e6" />
                  </g>
                </svg>
              </div>
            </div>
          </div>
          <div class="modal-footer border-top-0">
          </div>
        </div>
      </div>
    </div>

    </div>


    <div class="my-5"></div>

  </main>

  <footer class="footer mt-auto pt-3 pb-1" style="background-color: rgb(39, 39, 39);">
    <div class="footer-copyright text-center py-3">
      <div class="text-center">
        <div class="d-flex align-items-center justify-content-center">
          <div class="text-start d-inline-block align-center">
            <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js"
              data-name="bmc-button" data-slug="ansonlai" data-color="#FFDD00" data-emoji="" data-font="Lato"
              data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000"
              data-coffee-color="#ffffff"></script>
          </div>
          <div class="text-start d-inline-block align-center ms-3">
          </div>
        </div>
      </div>
      <p class="small mt-2 text-white">Want to support this site? Every dollar goes a long way to keep this
        site running.</p>
      <p class="small text-white"><a href="https://thecharmcheck.reference.legal/docs/privacy-policy/" target="_blank"
          class="text-white">Privacy</a> |
        <a href="https://thecharmcheck.reference.legal/docs/terms-of-use/" target="_blank" class="text-white">Terms of
          Use</a>
      </p>
    </div>
  </footer>

</body>

<script>
  function updateFormVisibility() {
    var formElement = document.querySelector('form');
    var childDivs = formElement.querySelectorAll(':scope > div');
    childDivs.forEach(function (div) {
      if (div.style.display === 'none') {
        div.style.removeProperty('display');
      }
    });
    var selectedApp = document.getElementById('appDescription').value;
    // Determine which form elements to show or hide
    switch (selectedApp) {
      case 'Tinder':
        break;
      case 'Hinge':
        document.getElementById('aboutMeDescription').parentNode.style.display = 'none';
        break;
      case 'Bumble':
        break;
      case 'Other App':
        break;
    }
  }

  document.getElementById('appDescription').addEventListener('change', updateFormVisibility);
</script>

<script>
  // Global variables
  const MAX_PHOTOS = 9;
  var messages = [
    {
      "role": "user",
      "content": [
      ]
    }
  ];
  var conversation = [{
    "role": "assistant",
    "content": [{
      "type": "text",
      // "contentType": "initialResponse",
      "text": "ðŸ‘‹ Hi! I'm the Charm Check chatbot. Let's chat about your results or workshop your bio!  Where do you want to start first?"
    }]
  }];
</script>

<script>
  // Save and restore from local storage
  function openDatabase() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open('ProfileDatabase', 1);

      request.onupgradeneeded = event => {
        const db = event.target.result;
        db.createObjectStore('images', { keyPath: 'id' });
      };

      request.onsuccess = () => resolve(request.result);
      request.onerror = event => reject(event.target.error);
    });
  }

  async function saveDataLocally() {
    // Save form data
    const formElements = document.querySelectorAll('#formCollection input, #formCollection textarea');
    formElements.forEach(element => {
      if (element.value) {
        localStorage.setItem(element.id, element.value);
      } else {
        localStorage.removeItem(element.id); // Remove from localStorage if the field is empty
      }
    });

    // Save or clear the additional Tinder URL field
    const tinderURL = document.getElementById('tinderURL').value;
    if (tinderURL) {
      localStorage.setItem('tinderURL', tinderURL);
    } else {
      localStorage.removeItem('tinderURL'); // Remove from localStorage if the field is empty
    }

    // Save images to IndexedDB
    const db = await openDatabase();
    const transaction = db.transaction('images', 'readwrite');
    const store = transaction.objectStore('images');

    // Clear the store first
    await store.clear();

    // Then add the current images
    const images = document.querySelectorAll('#image-container img');
    images.forEach((img, index) => {
      store.put({ id: index, src: img.src });
    });
  }


  async function restoreData() {
    // Restore form data
    const formElements = document.querySelectorAll('#formCollection input, #formCollection textarea');
    formElements.forEach(element => {
      const savedValue = localStorage.getItem(element.id);
      if (savedValue) {
        element.value = savedValue;
      }
    });

    // Restore the Tinder URL field
    const savedTinderURL = localStorage.getItem('tinderURL');
    if (savedTinderURL) {
      document.getElementById('tinderURL').value = savedTinderURL;
    }

    // Restore images from IndexedDB
    const db = await openDatabase();
    const transaction = db.transaction('images', 'readonly');
    const store = transaction.objectStore('images');

    store.openCursor().onsuccess = function (event) {
      const cursor = event.target.result;
      if (cursor) {
        displayImage(cursor.value.src); // Assuming you have a function `displayImage` to add images to the DOM
        cursor.continue();
      }
    };
  }

  // Call restoreData on page load
  document.addEventListener('DOMContentLoaded', restoreData);
</script>

<script>
  // Scripts to handle and convert image inputs
  function displayImage(base64Image) {
    // Count only 'image_url' type elements in the 'content' array
    var imageCount = document.querySelectorAll('#image-container > div').length;

    // Check if the number of image_url elements exceeds MAX_PHOTOS
    if (imageCount >= MAX_PHOTOS) {
      alert(`You cannot add more than ${MAX_PHOTOS} images.`);
      return; // Stop processing the new image
    }

    // Create a div element as a container
    var divContainer = document.createElement('div');
    divContainer.style.position = 'relative';
    divContainer.style.display = 'inline-block'; // Allows the X button to be positioned correctly

    // Create an image element
    var imgElement = document.createElement('img');
    imgElement.src = base64Image;
    imgElement.style.maxWidth = '150px';
    imgElement.style.maxHeight = '150px';
    imgElement.style.marginTop = '5px';
    imgElement.style.marginRight = '5px';
    imgElement.style.marginLeft = '5px';

    // Create an "X" button
    var closeButton = document.createElement('button');
    closeButton.innerHTML = 'X';
    closeButton.style.position = 'absolute';
    closeButton.style.top = '0';
    closeButton.style.right = '0';
    closeButton.style.background = 'red';
    closeButton.style.color = 'white';
    closeButton.style.border = 'none';
    closeButton.style.borderRadius = '3px'; // Rounded corners
    closeButton.style.width = '15px'; // Smaller width
    closeButton.style.height = '15px'; // Smaller height
    closeButton.style.cursor = 'pointer';
    closeButton.style.display = 'flex'; // Use flexbox for centering
    closeButton.style.justifyContent = 'center'; // Center horizontally
    closeButton.style.alignItems = 'center'; // Center vertically
    closeButton.style.fontSize = '0.8rem';

    // Attach event listener to the "X" button
    closeButton.addEventListener('click', function () {
      divContainer.remove();
    });
    closeButton.addEventListener('touchstart', function () {
      divContainer.remove();
    });

    // Append the image and the "X" button to the div
    divContainer.appendChild(imgElement);
    divContainer.appendChild(closeButton);

    // Append the div to the image container
    document.getElementById('image-container').appendChild(divContainer);

    // Additional UI adjustment
    document.getElementById('image-container').classList.add("mt-5");
    document.getElementById('photoCollector').classList.remove("offset-md-3");
    document.getElementById('formCollection').classList.remove("d-none");
    document.getElementById('formCollection').scrollIntoView({ behavior: 'smooth' });
    document.getElementById('padding-container').classList.add("d-none");
    document.getElementById('padding-container').classList.remove("d-md-block");
  }

  function convertToBase64(file, callback) {
    const reader = new FileReader();
    reader.onload = function (event) {
      callback(event.target.result);
    };
    reader.readAsDataURL(file);
  }

  function processImage(file) {
    convertToBase64(file, function (base64) {
      let img = new Image();
      img.onload = function () {
        let squareSize = Math.max(img.width, img.height);
        let canvas = document.createElement('canvas');
        canvas.width = canvas.height = squareSize;
        let ctx = canvas.getContext('2d');
        ctx.drawImage(img, (squareSize - img.width) / 2, (squareSize - img.height) / 2);
        let resizeCanvas = document.createElement('canvas');
        resizeCanvas.width = resizeCanvas.height = 512;
        let resizeCtx = resizeCanvas.getContext('2d');
        resizeCtx.drawImage(canvas, 0, 0, 512, 512);
        let dataURL = resizeCanvas.toDataURL('image/png');
        window.currentBase64Image = dataURL.split(',')[1]; // Remove the Data URL prefix for pure Base64
        displayImage(dataURL);

      };
      img.src = base64;
    });
  }

  // UI Helpers

  function setupSortable() {
    $('#image-container').sortable();
    $('#image-container').disableSelection();
  }

  function setup() {
    setupSortable();

    let dropArea = document.getElementById('drop-area');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropArea.addEventListener(eventName, preventDefaults, false);
    });

    dropArea.addEventListener('drop', handleDrop, false);
    document.getElementById('fileElem').addEventListener('change', handleBrowse, false);
  }

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  function handleDrop(e) {
    let dt = e.dataTransfer;
    let files = dt.files;
    handleFiles(files);
  }

  function handleBrowse(e) {
    handleFiles(e.target.files);
  }

  function handleFiles(files) {
    ([...files]).forEach(processImage);
  }
</script>

<script>
  // API Call Counter
  const API_CALL_LOG = 'profileReviewAPICallLog';
  const cutoffTimestamp = new Date().getTime() - (72 * 60 * 60 * 1000); // 72 hours in milliseconds

  function logAPICallTimestamp() {
    const currentTimestamp = new Date().getTime(); // Get current timestamp in milliseconds
    let callLog = JSON.parse(localStorage.getItem(API_CALL_LOG)) || []; // Parse the existing log, or initialize a new array
    callLog.push(currentTimestamp); // Add the current timestamp to the log
    localStorage.setItem(API_CALL_LOG, JSON.stringify(callLog)); // Save the updated log back to localStorage
  }

  function getRecentAPICallCount() {
    const callLog = JSON.parse(localStorage.getItem(API_CALL_LOG)) || [];
    // Filter out calls older than 72 hours
    const recentCalls = callLog.filter(timestamp => timestamp > cutoffTimestamp);
    // Update localStorage with the filtered log
    localStorage.setItem(API_CALL_LOG, JSON.stringify(recentCalls));
    // Get the oldest call timestamp within the last 72 hours
    const oldestTimestamp = recentCalls.length > 0 ? recentCalls[0] : null;
    return {
      count: recentCalls.length,
      oldestTimestamp
    };
  }

  function startCountdown(duration, displayElement) {
    let timer = duration, hours, minutes, seconds;
    const interval = setInterval(function () {
      hours = parseInt(timer / 3600, 10);
      minutes = parseInt((timer % 3600) / 60, 10);
      seconds = parseInt(timer % 60, 10);

      // Updated to spell out the units with their names
      displayElement.textContent = `${hours} hour${hours !== 1 ? 's' : ''}, ${minutes} minute${minutes !== 1 ? 's' : ''}, and ${seconds} second${seconds !== 1 ? 's' : ''}`;

      if (--timer < 0) {
        clearInterval(interval);
        document.getElementById("sendButton").disabled = false; // Re-enable the send button
        displayElement.textContent = ''; // Clear countdown text
      }
    }, 1000);
  }

  function checkAPICallCountAndPayment() {
    const MAX_API_CALLS = 3;
    const recentAPICallsInfo = getRecentAPICallCount();

    if (recentAPICallsInfo.count >= MAX_API_CALLS && !PAYMENT_MADE) {
      if (recentAPICallsInfo.oldestTimestamp) {
        const now = new Date().getTime();
        const timePassed = now - recentAPICallsInfo.oldestTimestamp;
        const remainingTime = (72 * 60 * 60 * 1000) - timePassed; // Time left in milliseconds
        const remainingSeconds = Math.floor(remainingTime / 1000);

        document.getElementById("sendButton").disabled = true; // Disable the send button
        $('#countdownWarning').removeClass('d-none');

        const countdownDisplayElement = document.getElementById("countdownDisplay");
        startCountdown(remainingSeconds, countdownDisplayElement);
      } else {
        document.getElementById("sendButton").disabled = true;
        document.getElementById("countdownDisplay").textContent = '72 hours'
        $('#countdownWarning').removeClass('d-none');

      }
      return false; // Prevent further API calls
    }
    document.getElementById("sendButton").disabled = false; // Disable the send button
    $('#countdownWarning').addClass('d-none');
    // If the limit has not been reached, proceed with the API call
    return true;
  }
</script>

<script>
  // Scripts to handle API call
  function addToMessageContent(dict, contentType) {
    var foundIndex = messages[0]['content'].findIndex(item => item.contentType === contentType);
    if (foundIndex !== -1) {
      messages[0]['content'][foundIndex] = dict;
    } else {
      messages[0]['content'].push(dict);
    }
  }

  function processForm() {
    // Clear message stack
    messages[0]['content'] = [];

    // Handle images first
    document.querySelectorAll('#image-container > div').forEach((div, index) => {
      var base64Image = div.querySelector('img').src;
      if (index < MAX_PHOTOS) {
        addToMessageContent({
          type: "image_url",
          image_url: {
            url: base64Image
          }
        }, `photo${index + 1}`);
      }
    });

    var appDescription = document.getElementById('appDescription').value;
    var appDescriptionText = "";
    switch (appDescription) {
      case "Tinder":
        appDescriptionText = "Tinder - Primarily known for casual dating and hookups. Profiles on Tinder tend to focus more on photos than detailed bios or prompts. Users often curate their photo selection to make an immediate visual impression, with less emphasis on detailed personal information or interests.";
        break;
      case "Hinge":
        appDescriptionText = "Hinge - Geared towards users seeking longer-term relationships and more meaningful connections. Profiles on Hinge are designed to be more detailed and require responses to prompts, which encourages users to share aspects of their personality and interests. It's more about showcasing one's character and less about quick visual appeal.";
        break;
      case "Bumble":
        appDescriptionText = "Bumble - Unique in that it allows women to initiate the conversation, often leading to more serious connections. The app is used for a mix of casual and more serious dating. Profiles on Bumble strike a balance between photos and personal details, with enough space for users to showcase their interests and personality traits.";
        break;
      case "Other App":
        appDescriptionText = "Other App - I have chosen an unlisted app.  Please use your best judgement to help me craft a great profile based on what I shared!";
        break;
      default:
        appDescriptionText = "Dating App: Not specified.";
    }

    function getValueIfVisible(elementId) {
      var element = document.getElementById(elementId);
      if (window.getComputedStyle(element.parentNode).display !== 'none') {
        return element.value;
      }
      return null; // or return an empty string '' as per your requirement
    }

    var aboutMeDescription = getValueIfVisible('aboutMeDescription');
    var ageDescription = getValueIfVisible('ageDescription');
    var interestsDescription = getValueIfVisible('interestsDescription');
    var relationshipTypeDescription = getValueIfVisible('relationshipTypeDescription');
    var jobTitleDescription = getValueIfVisible('jobTitleDescription');
    var importantDetailsDescription = getValueIfVisible('importantDetailsDescription');
    var promptsDescription1 = getValueIfVisible('promptsDescription1');
    var promptsAnswerDescription1 = getValueIfVisible('promptsAnswerDescription1');
    var promptsDescription2 = getValueIfVisible('promptsDescription2');
    var promptsAnswerDescription2 = getValueIfVisible('promptsAnswerDescription2');
    var promptsDescription3 = getValueIfVisible('promptsDescription3');
    var promptsAnswerDescription3 = getValueIfVisible('promptsAnswerDescription3');
    var additionalInformationDescription = getValueIfVisible('additionalInformationDescription');


    // Save data locally for easy entry next time
    saveDataLocally();

    // Add to message content
    if (appDescription) {
      addToMessageContent({
        type: "text",
        // contentType: "appDescription",
        text: `My Current Dating App: ${appDescriptionText}`
      }, "appDescription");
    }

    addToMessageContent({
      type: "text",
      // contentType: "profileHeader",
      text: `My dating profile currently contains the following fields`
    }, "profileHeader");

    if (aboutMeDescription) {
      addToMessageContent({
        type: "text",
        // contentType: "aboutMe",
        text: `About me: ${aboutMeDescription}`
      }, "aboutMe");
    }

    if (ageDescription) {
      addToMessageContent({
        type: "text",
        // contentType: "age",
        text: `Age: ${ageDescription}`
      }, "age");
    }

    if (interestsDescription) {
      addToMessageContent({
        type: "text",
        // contentType: "interests",
        text: `Interests: ${interestsDescription}`
      }, "interests");
    }

    if (relationshipTypeDescription) {
      addToMessageContent({
        type: "text",
        // contentType: "relationshipType",
        text: `Looking for: ${relationshipTypeDescription}`
      }, "relationshipType");
    }

    if (jobTitleDescription) {
      addToMessageContent({
        type: "text",
        // contentType: "jobTitle",
        text: `Profession/Education: ${jobTitleDescription}`
      }, "jobTitle");
    }

    if (importantDetailsDescription) {
      addToMessageContent({
        type: "text",
        // contentType: "importantDetails",
        text: `Some important details I want to highlight are: ${importantDetailsDescription}`
      }, "importantDetails");
    }

    if (promptsDescription1 || promptsAnswerDescription1) {
      addToMessageContent({
        type: "text",
        // contentType: "promptAnswer1",
        text: `The app lets me choose and answer a few prompts.  This is the first one: ${promptsDescription1} - Answer: ${promptsAnswerDescription1}`
      }, "promptAnswer");
    }

    if (promptsDescription2 || promptsAnswerDescription2) {
      addToMessageContent({
        type: "text",
        // contentType: "promptAnswer2",
        text: `This is the second prompt: ${promptsDescription2} - Answer: ${promptsAnswerDescription2}`
      }, "promptAnswer2");
    }

    if (promptsDescription3 || promptsAnswerDescription3) {
      addToMessageContent({
        type: "text",
        // contentType: "promptAnswer3",
        text: `And here is the third prompt: ${promptsDescription3} - Answer: ${promptsAnswerDescription3}`
      }, "promptAnswer3");
    }

    if (additionalInformationDescription) {
      addToMessageContent({
        type: "text",
        // contentType: "additionalInformation",
        text: `Additional Information: ${additionalInformationDescription}`
      }, "additionalInformation");
    }
  }


  function sendToAPI() {
    if (!checkAPICallCountAndPayment()) {
      return;
    };

    const apiUrl = "https://gptvisionapiopenai.azurewebsites.net/charm_check/";
    const headers = {
      "Content-Type": "application/json",
    };

    processForm();
    const payload = {
      model: "gpt-4-turbo",
      messages: messages,
      max_tokens: 1300
    };

    // add ClientSecret if relevant
    var paymentIntentClientSecret = localStorage.getItem('paymentIntentClientSecret');
    if (paymentIntentClientSecret) {
      payload['stripe_client_secret'] = paymentIntentClientSecret;
    }

    document.getElementById('loader').classList.remove("invisible");
    document.getElementById('sendButton').disabled = true;

    fetch(apiUrl, {
      method: "POST",
      headers: headers,
      body: JSON.stringify(payload)
    })
      .then(response => response.json())
      .then(data => handleAPIResponse(data)) // Pass the data to the new function
      .catch(error => {
        console.error('Error:', error);
        alert('We have tight content guidelines.  Please remove inappropriate photos, then try again.');
        document.getElementById('loader').classList.add("invisible");
        document.getElementById('sendButton').disabled = false;
        document.getElementById('sendButton').innerHTML = "<strong>Try Again</strong>";
      });
  }

  function handleAPIResponse(data) {
    var converter = new showdown.Converter();
    converter.setOption('disableForced4SpacesIndentedSublists', true);
    converter.setOption('smartIndentationFix', true);

    logAPICallTimestamp();

    let unhelpfulResponses = [
      `I'm sorry, I can't assist with that request.`,
      "I'm sorry, I cannot provide the assistance you're asking for.",
      "I'm sorry, I can't provide assistance with that request.",
      "I'm sorry, but I can't provide information based on these images.",
      "Unfortunately, I can't assist with that request.",
      "I'm sorry, I can't provide information about the person in the photo.",
      "I'm sorry, but I am unable to provide the service you are asking for.",
      "I'm sorry, I can't provide the requested analysis or suggestions."
    ];

    var text = data["response"]["choices"][0]['message']['content'];

    // Add to conversation if the report doesn't exist yet, otherwise, swap in place so only one report is in the conversation
    let report_found = false;
    for (let i = 0; i < conversation.length; i++) {
      const contentArray = conversation[i]['content'];
      for (let j = 0; j < contentArray.length; j++) {
        const contentItem = contentArray[j];
        if (contentItem['contentType'] === 'report') {
          // Found an existing report, update its text
          contentItem['text'] = text;
          report_found = true;
          // Add to conversation that a new report was requested
          conversation.push({
            "role": "user",
            "content": [{
              "type": "text",
              // "contentType": "userInput",
              "text": "Thanks for changing your report with my new information!"
            }]
          });
          break; // Exit the loop as we've found and updated the report
        }
      }
      if (report_found) break; // Exit the outer loop as well
    }
    if (!report_found) {
      // No existing report found, add a new one
      conversation.unshift({
        "role": "assistant",
        "content": [{
          "type": "text",
          "contentType": "report",
          "text": text
        }]
      });
    }

    var html = converter.makeHtml(text);
    if (unhelpfulResponses.includes(text)) {
      throw new Error('GPT cannot assist.');
    }
    document.getElementById('apiResponse').innerHTML = html;
    document.getElementById('analysis-container').classList.remove("d-none");
    document.getElementById('chat-container').classList.remove("d-none");
    document.getElementById('loader').classList.add("invisible");
    document.getElementById('analysis-container').scrollIntoView({ behavior: 'smooth' });
    document.getElementById('sendButton').disabled = false;
    document.getElementById('sendButton').innerHTML = "<strong>Try Again</strong>";
  }
</script>

<script>
  // Chatbot scripts
  function sendToConversationAPI() {
    const apiUrl = "https://gptvisionapiopenai.azurewebsites.net/charm_check_conversation/";
    const headers = {
      "Content-Type": "application/json",
    };

    var payload = {
      model: "gpt-4-turbo",
      messages: messages,
      conversation: conversation,
      max_tokens: 1300
    };

    // add ClientSecret if relevant
    var paymentIntentClientSecret = localStorage.getItem('paymentIntentClientSecret');
    if (paymentIntentClientSecret) {
      payload['stripe_client_secret'] = paymentIntentClientSecret;
    }

    // Disable chat
    document.getElementById('chat-loader').style.visibility = 'visible';
    document.getElementById('buttonSend').disabled = true;

    // Send the POST request
    fetch(apiUrl, {
      method: "POST",
      headers: headers,
      body: JSON.stringify(payload)
    })
      .then(response => response.json())
      .then(data => {
        handleConversationAPIResponse(data)
        // Allow chat again areas
        document.getElementById('chat-loader').style.visibility = 'hidden';
        document.getElementById('buttonSend').disabled = false;
      }) // Pass the data to the new function
      .catch(error => {
        console.error('Error:', error);
        alert('There was an error with your chat.  Please hit submit to try again.');
        document.getElementById('chat-loader').style.visibility = 'hidden';
        document.getElementById('buttonSend').disabled = false;
        // Remove the last message from the conversation array
        conversation.pop();
        // Cross out the text of the last message in the chat display
        var lastMessage = $("#chatDisplay").children().last();
        lastMessage.find('div.text-start, div.h-100').css('text-decoration', 'line-through');
      });
  }

  function handleConversationAPIResponse(data) {
    var converter = new showdown.Converter();
    converter.setOption('disableForced4SpacesIndentedSublists', true);
    converter.setOption('smartIndentationFix', true);

    var text = data["response"]["choices"][0]['message']['content'];

    conversation.push({
      "role": "assistant",
      "content": [{
        "type": "text",
        // "contentType": "responseOutput",
        "text": text
      }]
    });
    var html = converter.makeHtml(text);

    addToConversation('assistant', html)
  }

  // addToConveration
  function addToConversation(role, message) {
    var converter = new showdown.Converter();
    converter.setOption('disableForced4SpacesIndentedSublists', true);
    converter.setOption('smartIndentationFix', true);
    var html = converter.makeHtml(message);
    if (role == "user") {
      var newDiv = $(`
        <div class="user-convo row py-2">
          <div class="col-1 d-flex align-items-center justify-content-center" style="font-size: 3rem;">
            <div class="d-flex align-items-center ms-3">
            </div>
          </div>
          <div class="col-11 ps-0">
            <div class="d-flex justify-content-end p-3 rounded shadow-sm me-3" style="background-color: #ffcccc;">
              <div class="text-start">
                ${html}
              </div>
            </div>
          </div>
        </div>
      `)
    } else if (role == "assistant") {
      var newDiv = $(`
        <div class="assistant-convo row py-2">
          <div class="col-11">
            <div class="h-100 p-3 rounded shadow-sm ms-3"
              style="background-color: #f9f9f9;">
              ${html}
            </div>
          </div>
          <div class="col-1 d-flex align-items-center justify-content-center" style="font-size: 3rem;">
            <div class="d-flex align-items-center me-3">
            </div>
          </div>
        </div>
      `)
    };

    $("#chatDisplay").append(newDiv);
    // Scroll to the bottom of the chatDisplay
    var chatDisplay = $("#chatDisplay");
    chatDisplay.scrollTop(chatDisplay.prop("scrollHeight"));
  };

  // UI Helpers
  $('#buttonSend').click(function () {
    if ($('#floatingTextarea').val() != "") {
      $('#nameHero').hide();
      // TODO: Prune messages if too long
      conversation.push({
        "role": "user",
        "content": [{
          "type": "text",
          // "contentType": "userInput",
          "text": $('#floatingTextarea').val()
        }]
      });
      addToConversation('user', $('#floatingTextarea').val())
      // TODO: ADD CHATBOT PAYWALL HERE
      // if (conversation.length > 4 && !PAYMENT_MADE) {
      //   $('#paywallOverlay').removeClass('d-none');
      //   document.getElementById('floatingTextarea').blur();
      //   document.getElementById('buttonSend').blur();
      // }
      sendToConversationAPI();
      document.getElementById('chat-loader').style.visibility = 'visible';
      $('#floatingTextarea').val('');
      $('#floatingTextarea').attr('rows', '1');
    }
  });

  // Handle alt+enter
  const textarea = document.getElementById("floatingTextarea");
  const buttonSend = document.getElementById("buttonSend");

  textarea.addEventListener("keydown", function (e) {
    if (e.key === "Enter" && !event.isComposing && !e.shiftKey && !e.ctrlKey && !e.altKey) {
      e.preventDefault(); // Prevent the default behavior (line break)
      buttonSend.click(); // Trigger the button click
    }
  });

  // Auto expand textarea: https://gist.github.com/i-havr/6b8e6f39da421360c6c054c9d2765d61, https://codepen.io/vsync/details/bGgQzL
  function getScrollHeight(elm) {
    var savedValue = elm.value
    elm.value = ''
    elm._baseScrollHeight = elm.scrollHeight
    elm.value = savedValue
  }

  // Minimize/Maximize chatbot
  function onExpandableTextareaInput({ target: elm }) {
    if (!elm.classList.contains('autoExpand') || !elm.nodeName == 'TEXTAREA') return

    var minRows = elm.getAttribute('data-min-rows') | 0, rows;
    !elm._baseScrollHeight && getScrollHeight(elm)

    elm.rows = minRows
    rows = Math.ceil((elm.scrollHeight - elm._baseScrollHeight) / 24)
    elm.rows = minRows + rows
  }
  document.addEventListener('input', onExpandableTextareaInput);

  document.getElementById('close-chat-container-button').addEventListener('click', function () {
    document.getElementById('chat-container').classList.add('d-none');
    document.getElementById('chat-container-minimized').classList.remove('d-none');
  });

  document.getElementById('chat-container-minimized').addEventListener('click', function () {
    document.getElementById('chat-container-minimized').classList.add('d-none');
    document.getElementById('chat-container').classList.remove('d-none');
  });
</script>

<script>
  // Handle Stripe.js payments
  const stripe = Stripe("pk_live_51OILtSIELqMaA55AoAxgHHwft4t0Fxl7hbiP3A3hlV5e9H2wId7G88A69bfixupL2Xa2K9739DdcHa5DY3liVcC10078uHrsW5");

  let elements;
  var PAYMENT_MADE = false;
  checkIfPreviouslyPaid();

  // Fetches a payment intent and captures the client secret
  function initialize() {
    fetch("https://gptvisionapiopenai.azurewebsites.net/stripe/process_payment/", {
      method: "POST",
      body: JSON.stringify({
        "amount": 399,
        "currency": "usd"
      }),
    }).then(response => response.json())
      .then(data => {
        const clientSecret = data['response']['client_secret'];

        const appearance = {
          theme: 'stripe',
        };
        elements = stripe.elements({ appearance, clientSecret });

        const paymentElementOptions = {
          layout: "tabs",
        };

        const paymentElement = elements.create("payment", paymentElementOptions);
        paymentElement.mount("#payment-element");

      })
      .catch(error => {
        console.error('Error:', error);
      });
  }

  async function handleSubmit(e) {
    setLoading(true);

    try {
      const response = await stripe.confirmPayment({
        elements,
        confirmParams: {
          return_url: "http://thecharmcheck.com/",
          // receipt_email: emailAddress,
        },
        redirect: 'if_required',
      });

      const { error, paymentIntent } = response;

      if (error) {
        if (error.type === "card_error" || error.type === "validation_error") {
          showMessage(error.message);
        } else {
          showMessage("An unexpected error occurred.");
        }
      } else if (paymentIntent && paymentIntent.status === "succeeded") {
        showMessage("Payment succeeded!");

        handlePaymentSuccess(paymentIntent.client_secret, paymentIntent.created);
      } else {
        showMessage("Payment failed!");
      }

    } catch (error) {
      console.log("Caught an exception");
      showMessage("An unexpected error occurred.");
    }

    setLoading(false);
  }

  // Fetches the payment intent status after payment submission
  async function checkStatus() {
    const clientSecret = new URLSearchParams(window.location.search).get(
      "payment_intent_client_secret"
    );

    if (!clientSecret) {
      return;
    }

    const { paymentIntent } = await stripe.retrievePaymentIntent(clientSecret);

    switch (paymentIntent.status) {
      case "succeeded":
        showMessage("Payment succeeded!");
        break;
      case "processing":
        showMessage("Your payment is processing.");
        break;
      case "requires_payment_method":
        showMessage("Your payment was not successful, please try again.");
        break;
      default:
        showMessage("Something went wrong.");
        break;
    }
  }

  function handlePaymentSuccess(clientSecret, created) {
    var paymentModal = document.getElementById('paymentModal');
    var modalInstance = bootstrap.Modal.getInstance(paymentModal);
    var paymentForm = document.getElementById('payment-form');

    PAYMENT_MADE = true;

    // document.getElementById('paywallOverlay').classList.add('d-none');
    checkAPICallCountAndPayment();

    setTimeout(function () {
      modalInstance.hide();
      paymentForm.remove();
    }, 2000);

    localStorage.setItem('paymentIntentClientSecret', clientSecret);
    localStorage.setItem('paymentIntentCreated', created);
  }

  function checkIfPreviouslyPaid() {
    // Retrieve the items from localStorage
    var paymentIntentClientSecret = localStorage.getItem('paymentIntentClientSecret');
    var paymentIntentCreated = localStorage.getItem('paymentIntentCreated');

    // Check if time is in the last 7 days
    if (paymentIntentCreated) {
      var storedDate = new Date(parseInt(paymentIntentCreated) * 1000);
      var currentDate = new Date();
      // Calculate the difference in milliseconds
      var differenceInMs = currentDate - storedDate;
      var differenceInDays = differenceInMs / (1000 * 60 * 60 * 24);
      // Check if stored timestamp is within last 7 days
      if (differenceInDays <= 7) {
        var paymentForm = document.getElementById('payment-form');
        // document.getElementById('paywallOverlay').classList.add('d-none');
        paymentForm.remove();
        PAYMENT_MADE = true;
      } else {
        console.log("The stored timestamp is older than 7 days.");
        checkAPICallCountAndPayment();
      }
    } else {
      console.log("No stored timestamp found.");
      checkAPICallCountAndPayment();
    }
  }

  // ------- UI helpers -------
  function showMessage(messageText) {
    const messageContainer = document.querySelector("#payment-message");

    messageContainer.classList.remove("hidden");
    messageContainer.textContent = messageText;

    setTimeout(function () {
      messageContainer.classList.add("hidden");
      messageContainer.textContent = "";
    }, 4000);
  }

  // Show a spinner on payment submission
  function setLoading(isLoading) {
    if (isLoading) {
      // Disable the button and show a spinner
      document.querySelector("#paymentSubmit").disabled = true;
      document.querySelector("#paymentSubmit").style.background = '#d3d3d3';
      document.querySelector("#spinner").classList.remove("hidden");
      document.querySelector("#button-text").classList.add("hidden");
    } else {
      document.querySelector("#paymentSubmit").disabled = false;
      document.querySelector("#paymentSubmit").style.background = '#5469d4';
      document.querySelector("#spinner").classList.add("hidden");
      document.querySelector("#button-text").classList.remove("hidden");
    }
  }

  // Animate overlay
  // document.addEventListener('DOMContentLoaded', (event) => {
  //   const overlay = document.getElementById('paywallOverlay');
  //   let opacity = 0.5;
  //   let increasing = true;

  //   setInterval(() => {
  //     if (increasing) {
  //       opacity += 0.05; // Smaller increment
  //       if (opacity >= 0.8) increasing = false;
  //     } else {
  //       opacity -= 0.05; // Smaller decrement
  //       if (opacity <= 0.3) increasing = true;
  //     }
  //     overlay.style.backgroundColor = `rgba(0, 0, 0, ${opacity})`;
  //   }, 400); // Slower interval
  // });
</script>

<script>
  // Handle Tinder Imports
  function fetchTinderProfile(username) {
    const apiUrl = `https://charmcheck-importer.azurewebsites.net/api/tinder?url=${encodeURIComponent(username)}`;

    fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        tinderURLInput.classList.remove('d-none');
        fetchProfileButton.classList.remove('d-none');
        document.getElementById('tinder-loader').classList.add('d-none');
        if (data.images && data.images.length > 0) {
          data.images.forEach(currentBase64Image => {
            // TODO: Heavy refactor, this is overlap with processImage(file) which needs refactoring too
            displayImage(`data:image/jpeg;base64,${currentBase64Image}`);
            var imageCount = document.querySelectorAll('#image-container > div').length;
            if (imageCount >= MAX_PHOTOS) {
              alert(`You cannot add more than ${MAX_PHOTOS} images.`);
              return; // Stop processing the new image
            }
            addToMessageContent({
              type: "image_url",
              image_url: {
                url: `data:image/jpeg;base64,${currentBase64Image}`
              }
            }, `photo${imageCount}`);
          });
        } else {
          alert('No images found for this profile.');
        }

        // Update form elements
        if (data.age) {
          document.getElementById('ageDescription').value = data.age;
        }
        let jobOrSchool = data.job_title ? data.job_title : '';
        jobOrSchool += data.company_name ? ` at ${data.company_name}` : '';
        jobOrSchool += (!data.job_title && data.school) ? data.school : '';
        document.getElementById('jobTitleDescription').value = jobOrSchool;
      })
      .catch(error => {
        console.error('Error fetching profile:', error);
        alert('Failed to fetch profile.');
        tinderURLInput.classList.remove('d-none');
        fetchProfileButton.classList.remove('d-none');
        document.getElementById('tinder-loader').classList.add('d-none');
      });
  }

  // UI Helpers
  // Get the elements
  var tinderURLInput = document.getElementById('tinderURL');
  var fetchProfileButton = document.getElementById('fetchProfileButton');

  // Event listener for the button click
  fetchProfileButton.addEventListener('click', function () {
    handleFetchProfile();
  });

  // Event listener for the input field to detect the Enter key press
  tinderURLInput.addEventListener('keypress', function (event) {
    if (event.keyCode === 13 || event.which === 13) { // 13 is the keycode for Enter
      event.preventDefault(); // Prevent the default action of the Enter key in a form
      handleFetchProfile();
    }
  });

  // Function to handle fetching the profile
  function handleFetchProfile() {
    var tinderURL = tinderURLInput.value;
    fetchTinderProfile(tinderURL); // Replace with the desired function call

    // Hide the input and button
    tinderURLInput.classList.add('d-none');
    fetchProfileButton.classList.add('d-none');

    // Show the loader
    document.getElementById('tinder-loader').classList.remove('d-none');
  }

</script>

<script>
  // Download Docx Report Feature
  function downloadAsDocx() {
    var content = document.getElementById('report-container').innerHTML;
    var content = content + '<br><br><p class="h1 text-center pt-5" style="color:#A7A5A5">Charm Check Chat History</p>'
    var content = content + document.getElementById('chatDisplay').innerHTML;
    var content = '<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head>' + content;

    var converted = htmlDocx.asBlob(content);
    function formatDate(date) {
      var d = new Date(date),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();

      if (month.length < 2)
        month = '0' + month;
      if (day.length < 2)
        day = '0' + day;

      return [year, month, day].join('-');
    }

    var today = formatDate(new Date());
    var fileName = 'Charm Check Dating Profile Report - ' + today + '.docx';

    saveAs(converted, fileName);
  }
</script>

</html>